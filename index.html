<!DOCTYPE HTML>
<html>
<head>
    <title>Coral Observations</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    <style>
        #map { height: 600px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, textarea, button {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #0077b6;
            color: white;
            border: none;
            margin-top: 10px;
            cursor: pointer;
        }
        button:hover { background-color: #005f87; }
    </style>
</head>
<body class="is-preload">

    <!-- Header -->
    <header id="header" style="background-color: #002244;">
        <h1 style="color:white; margin-left: 1em;">Coral Observation Map</h1>
    </header>

    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner" style="display: flex; gap: 2rem; flex-wrap: wrap;">
            <!-- Form -->
            <div style="flex: 1; min-width: 300px;">
                <form id="observationForm">
                    <h3>Let us know whether you did or didn't see corals where you swam!</h3>

                    <label for="area">Area</label>
                    <input type="text" id="area" name="data[area]" required>

                    <label for="species">Species Observed</label>
                    <input type="text" id="species" name="data[species]" required>

                    <label for="observer">Observer Name</label>
                    <input type="text" id="observer" name="data[observer]">

                    <label for="notes">Notes</label>
                    <textarea id="notes" name="data[notes]" rows="4"></textarea>

                    <label for="photo">Photo Upload</label>
                    <input type="file" id="photo" name="data[photo]" accept="image/*">

                    <label for="lat">Latitude</label>
                    <input type="text" id="lat" name="data[latitude]" readonly required>

                    <label for="lng">Longitude</label>
                    <input type="text" id="lng" name="data[longitude]" readonly required>

                    <button type="submit">Submit Observation</button>
                </form>
            </div>

            <!-- Map -->
            <div style="flex: 1; min-width: 300px;">
                <div id="map"></div>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // Initialize map
        const map = L.map('map').setView([-33.85, 151.2], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Marker drop
        let marker;
        map.on('click', function (e) {
            const lat = e.latlng.lat.toFixed(6);
            const lng = e.latlng.lng.toFixed(6);
            document.getElementById('lat').value = lat;
            document.getElementById('lng').value = lng;

            if (marker) {
                marker.setLatLng(e.latlng);
            } else {
                marker = L.marker(e.latlng).addTo(map);
            }
        });

        // Handle form submit
        document.getElementById('observationForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(e.target);

            fetch("https://sheetdb.io/api/v1/qv8axipdm0sak", {
                method: "POST",
                body: formData
            }).then(res => {
                if (res.ok) {
                    alert("✅ Submitted!");
                    e.target.reset();
                    if (marker) map.removeLayer(marker);
                } else {
                    alert("❌ Submission failed.");
                }
            }).catch(() => alert("❌ Network error."));
        });
    </script>
</body>
</html>
